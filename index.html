<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ClustARK Gen2 Server Status</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="card p-4">
      <h2 class="mb-4">ðŸŽ® ClustARK Gen2 Server Status</h2>
      <p><strong>Server Name:</strong> <span id="serverName">Loadingâ€¦</span></p>
      <p><strong>Map:</strong> <span id="mapName">Loadingâ€¦</span></p>
      <p><strong>Players:</strong> <span id="playerCount">Loadingâ€¦</span></p>
      <h5 class="mt-3">Connected Players:</h5>
      <ul id="playerList" class="list-group">
        <li class="list-group-item">Loadingâ€¦</li>
      </ul>
    </div>
  </div>

  <script>
    const API_URL = 'https://corsproxy.io/?https://api.trackyserver.com/widget/index.php?id=1001651';

    function refreshServerData(mapping) {
      $.getJSON(API_URL)
        .done(data => {
          $('#serverName').text(data.name || 'Unknown');
          $('#mapName').text(data.map || 'Unknown');
          $('#playerCount').text(data.playerscount ?? 'Offline');
          const $pl = $('#playerList').empty();

          if (Array.isArray(data.playerslist) && data.playerslist.length > 0) {
            data.playerslist.forEach(p => {
              const mapEntry = mapping[p.name];
              const charName = mapEntry?.character || p.name;
              const tribeName = mapEntry?.tribe ? ` (${mapEntry.tribe})` : '';
              const displayName = `${charName}${tribeName}`;
              $pl.append(`<li class="list-group-item">${displayName}</li>`);
            });
          } else {
            $pl.append('<li class="list-group-item">No players connected</li>');
          }
        })
        .fail(() => {
          $('#serverName, #mapName, #playerCount').text('Error');
          $('#playerList').html('<li class="list-group-item bg-danger">Failed loading player list</li>');
        });
    }

    $(document).ready(() => {
      $.getJSON('mappings.json', function(mapping) {
        refreshServerData(mapping);
        setInterval(() => refreshServerData(mapping), 30000);
      }).fail(() => {
        alert('Failed to load mappings.json');
      });
    });
  </script>
</body>
</html>